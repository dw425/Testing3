<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint Technologies | 2026 Strategic Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #000000;
            background-image: radial-gradient(ellipse 80% 50% at 50% 0%, rgba(20, 50, 90, 0.6), transparent 100%);
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        .tab-active {
            background-color: #3b82f6;
            color: white;
        }
        .pillar-active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .chart-container {
            position: relative;
            height: 150px;
            width: 150px;
            margin: 0 auto;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%239CA3AF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 0.65rem auto;
            padding-right: 2.5rem;
        }
        @keyframes trophy-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }
        .trophy-winner {
            animation: trophy-bounce 2s ease-in-out infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); }
        }
        .leader-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        .sidebar-tab {
            text-align: left;
            width: 100%;
            padding: 0.75rem 1rem;
            border-left: 3px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .sidebar-tab:hover {
            background-color: rgba(55, 65, 81, 0.5);
            border-left-color: #6b7280;
        }
    </style>
</head>
<body class="text-gray-300">

    <header class="bg-black/90 backdrop-blur-sm sticky top-0 z-10 border-b border-gray-800">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-x-4">
                    <a href="https://bpcs.com/" title="Blueprint Home">
                        <img width="120" height="24" src="https://bpcs.com/wp-content/uploads/2021/02/BlueprintLogo_White_Tiles-400x81.png" alt="Blueprint Logo">
                    </a>
                    <span class="border-l border-gray-700 h-6"></span>
                    <h2 class="text-base font-semibold text-gray-400 hidden sm:block">2026 Strategic Plan</h2>
                </div>
                <div class="flex items-center gap-x-6">
                    <a href="comps.html" class="border border-white/70 hover:border-white text-white text-sm font-semibold py-1.5 px-4 rounded-md transition-colors">
                    Goals Comparison
                    </a>
                    <a href="stack.html" class="border border-white/70 hover:border-white text-white text-sm font-semibold py-1.5 px-4 rounded-md transition-colors">
                    Product Comparison
                    </a>
                    <a href="https://bpcs.com/contact" class="border border-white/70 hover:border-white text-white text-sm font-semibold py-1.5 px-4 rounded-md transition-colors">
                    Connect
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- Strategic Pillars in Top Bar -->
        <div class="border-t border-gray-800 bg-gray-900/30">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3">
                <div class="flex items-center gap-3 flex-wrap">
                    <span class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Filter by Strategy:</span>
                    <div id="pillars-inline" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <section class="bg-gray-900/50 border border-gray-700 p-4 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-white mb-2">Blueprint 2026 Strategic Initiatives</h2>
                <p class="text-sm text-gray-400">
                    BHAG: "To become the indispensable AI and product engine of the Databricks ecosystem, transforming from a services-led consultancy into the undisputed, product-first leader whose success is measured not by billable hours, but by market-defining product adoption and winning the Databricks Partner of the Year Award."
                </p>
            </section>

            <section class="bg-gray-900/50 border border-gray-700 p-4 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold text-white mb-3">Goal Tracker</h3>
                <div class="flex justify-between items-center gap-4">
                    <div class="grid grid-cols-2 gap-2 flex-1">
                        <div class="bg-gray-800/50 p-2 rounded-lg border border-gray-700">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">Total</p>
                            <p id="total-krs" class="text-lg font-bold text-white">0</p>
                        </div>
                        <div class="bg-gray-800/50 p-2 rounded-lg border border-gray-700">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">Done</p>
                            <p id="completed-krs" class="text-lg font-bold text-emerald-500">0</p>
                        </div>
                        <div class="bg-gray-800/50 p-2 rounded-lg border border-gray-700">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">On Track</p>
                            <p id="ontrack-krs" class="text-lg font-bold text-blue-500">0</p>
                        </div>
                        <div class="bg-gray-800/50 p-2 rounded-lg border border-gray-700">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">At Risk</p>
                            <p id="atrisk-krs" class="text-lg font-bold text-amber-500">0</p>
                        </div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <svg class="transform -rotate-90" width="120" height="120">
                                <circle cx="60" cy="60" r="50" stroke="#374151" stroke-width="8" fill="none"/>
                                <circle id="progress-circle" cx="60" cy="60" r="50" stroke="#10b981" stroke-width="8" fill="none"
                                        stroke-dasharray="314" stroke-dashoffset="314" stroke-linecap="round"
                                        class="transition-all duration-1000 ease-out"/>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span id="progress-percentage" class="text-xl font-bold text-white">0%</span>
                                <span class="text-xs text-gray-400">Done</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <section class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-3 text-center">2026 North Star Metrics</h2>
            <div id="north-star-metrics-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3"></div>
            <div id="symbol-legend" class="mt-3 flex flex-wrap justify-center items-center gap-x-4 gap-y-2 text-xs text-gray-400"></div>
        </section>

        <section class="mb-6 bg-gray-900/50 border border-gray-700 p-3 rounded-xl shadow-lg">
            <div class="flex items-center justify-between">
                <h3 class="text-base font-bold text-white">üèÜ Top Performers</h3>
                <div id="leaderboard-content" class="flex gap-4"></div>
            </div>
        </section>

        <section class="mb-6">
            <div class="p-3 bg-gray-900/50 border border-gray-700 rounded-xl flex flex-col sm:flex-row gap-3 items-center">
                <div class="relative flex-grow w-full sm:w-auto">
                    <input type="search" id="okr-search" placeholder="Search objectives and key results..." class="w-full bg-gray-800 border border-gray-600 rounded-md py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white text-sm">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                    </div>
                </div>
                <select id="area-filter" class="bg-gray-800 border border-gray-600 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white w-full sm:w-auto text-sm"></select>
            </div>
        </section>

        <div id="pillar-filter-feedback" class="mb-3 text-center text-sm text-gray-400" style="display: none;"></div>

        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4">Departmental OKRs</h2>
            <div class="grid grid-cols-12 gap-4">
                <!-- Left Sidebar -->
                <div class="col-span-12 lg:col-span-2">
                    <div class="bg-gray-900/70 rounded-xl shadow-lg border border-gray-700 sticky top-24">
                        <div id="sidebar-tabs" class="flex flex-col"></div>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-span-12 lg:col-span-10">
                    <div class="bg-gray-900/70 rounded-xl shadow-lg border border-gray-700 p-4 md:p-6">
                        <div id="tab-content"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-4 border-t border-gray-800">
        <p class="text-center text-xs text-gray-500">&copy; 2026 Blueprint Technologies. All Rights Reserved.</p>
    </footer>

    <div id="north-star-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-600">
            <header class="p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
                <h3 id="north-star-modal-title" class="text-lg font-bold text-white"></h3>
                <button id="north-star-modal-close" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </header>
            <div id="north-star-modal-content" class="p-4 overflow-y-auto space-y-3"></div>
        </div>
    </div>

    <script>
        const strategyData = {
            northStarMetrics: [
                { id: "revenue", symbol: "üí∞", label: "Revenue Growth", value: "$23M", sub: "New Bookings", description: "Targeting $23M in new bookings and 150% Net Revenue Retention." },
                { id: "customers", symbol: "ü§ù", label: "Customer Acquisition", value: "180+", sub: "New Customers", description: "Secure over 180 new high-value customers through strategic outreach." },
                { id: "profit", symbol: "üìà", label: "Profitability", value: "21%", sub: "EBITDA Margin", description: "Increase our overall EBITDA margin to a target of 21%." },
                { id: "leadership", symbol: "üèÜ", label: "Market Leadership", value: "Top Tier", sub: "Awards & Recognition", description: "Win a Databricks Partner of the Year Award and achieve Gartner Magic Quadrant placement." },
                { id: "alliances", symbol: "üîó", label: "Strategic Alliances", value: "3x", sub: "Partner Bookings", description: "Achieve 3x partner-sourced bookings via Databricks and elevate Microsoft partnership status." },
            ],
            strategicPillars: [
                { id: "duality", name: "Product Duality", description: "The strategy of building proprietary products (like Liftoff and Synapse) while also providing services. Balancing product-led growth with traditional consulting delivery." },
                { id: "flywheel", name: "Awards-to-Sales Flywheel", description: "A marketing/sales strategy where winning industry awards (like Databricks Partner of the Year) creates marketing campaigns that generate leads and drive the sales pipeline in a self-reinforcing cycle." },
                { id: "troika", name: "Troika Partnership Model", description: "The three-way partnership strategy between Blueprint, Databricks, and cloud hyperscalers (AWS, Azure, GCP). Leveraging these strategic alliances for co-selling and mutual growth." },
                { id: "talent", name: "Builder vs. Scaler Model", description: "A dual-career talent framework: Builders (innovation-focused, work in Center of Excellence, create IP) and Scalers (delivery-focused, billable consultants who implement solutions)." },
                { id: "opensource", name: "Strategic Open Source", description: "Releasing valuable components as open-source projects to build brand recognition, attract talent, and establish thought leadership." },
            ],
            departmentIcons: {
                "Product": "üí°",
                "Technology": "ü§ñ",
                "Delivery": "üöÄ",
                "Sales": "ü§ù",
                "Marketing": "üî•",
                "Operations": "‚öôÔ∏è"
            },
            departments: [
                 {
                    name: "Product",
                    goal: "To build and manage a market-defining portfolio of Databricks-native products that drive scalable, high-margin revenue and establish Blueprint as an indispensable technology partner.",
                    objectives: [
                        { title: "Launch Flagship Products to Capture On-Ramp and AI Markets", pillar: "duality", northStar: ["revenue", "leadership", "customers"], keyResults: [
                            { text: "Complete the MVP of the Liftoff automated migration accelerator by March 31", status: "Not Started" },
                            { text: "Release the Synapse agentic AI framework with an initial library of 15 pre-built industry agents by September 1", status: "Not Started" },
                            { text: "Secure 5 paying pilot customers for Liftoff and generate $250k in pipeline from Synapse by EOY", status: "Not Started" },
                            { text: "Achieve a 40% reduction in migration time and cost for pilot customers", status: "Not Started" },
                            { text: "Co-present a Synapse success story with a strategic client at a major industry webinar", status: "Not Started" },
                        ]},
                        { title: "Dominate the Databricks Ecosystem and Achieve Premier Partner Status", pillar: "troika", northStar: ["alliances", "leadership"], keyResults: [
                            { text: "Get Liftoff and Synapse officially certified as Databricks Brickbuilder Solutions", status: "Not Started" },
                            { text: "Publish one of our products on the Databricks Marketplace and generate 100 qualified leads from it", status: "Not Started" },
                            { text: "Achieve a 9/10 partner satisfaction score from the Databricks product alignment team", status: "Not Started" },
                            { text: "Develop a comprehensive partner enablement program with certification for 5 strategic partners", status: "Not Started" },
                            { text: "Generate $1M in partner-influenced revenue by EOY", status: "Not Started" },
                        ]},
                        { title: "Operationalize the 'Blueprint Way' Productization Framework", pillar: "talent", northStar: ["profit"], keyResults: [
                            { text: "Publish the official Accelerator vs. Tool vs. Product decision matrix and governance model by Jan 31", status: "Not Started" },
                            { text: "Achieve 100% adoption of the new product lifecycle management (PLM) software across all teams", status: "Not Started" },
                            { text: "Retire at least 5 legacy accelerators to refocus engineering efforts on core products", status: "Not Started" },
                            { text: "Implement a value-based, three-tiered pricing model for all major products by Q2", status: "Not Started" },
                            { text: "Shift 50% of product-related revenue from services to a recurring/licensing model by EOY", status: "Not Started" },
                        ]},
                        { title: "Drive Product-Led Growth and Market-Driven Innovation", pillar: "duality", northStar: ["customers", "revenue", "leadership"], keyResults: [
                            { text: "Develop a self-service trial or demo environment for one of our On-Ramp tools, generating 200 new MQLs", status: "Not Started" },
                            { text: "Recruit 10 strategic customers for a Customer Advisory Board (CAB) to drive H2 roadmap", status: "Not Started" },
                            { text: "Produce quarterly competitive landscape reports to identify 3 white space opportunities", status: "Not Started" },
                            { text: "Achieve a 10% conversion rate from free trial to a paid discovery engagement", status: "Not Started" },
                            { text: "Incorporate the top 5 feedback items from the CAB into the H2 product roadmap", status: "Not Started" },
                        ]}
                    ]
                },
                 {
                    name: "Technology",
                    goal: "To build and manage a secure, scalable, and innovative technology foundation that powers our products and positions Blueprint as a pioneer in the AI and data landscape.",
                    objectives: [
                        { title: "Build the Cortex Platform & Proprietary AI Foundation", pillar: "duality", northStar: ["leadership", "profit"], keyResults: [
                            { text: "Build a functional Cortex prototype with core Ontology, Control Plane, and Action Graph layers", status: "Not Started" },
                            { text: "Develop and train a proprietary LLM fine-tuned on anonymized data for a core vertical (e.g., Retail)", status: "Not Started" },
                            { text: "Achieve a 10% higher accuracy on a key industry benchmark task compared to baseline GPT-4", status: "Not Started" },
                            { text: "Build an automated LLMOps pipeline, reducing manual model deployment effort by 90%", status: "Not Started" },
                            { text: "Secure 2 pilot customers to test and validate the vertical-specific model", status: "Not Started" },
                        ]},
                        { title: "Develop and Commercialize a Scalable AI Agent Library", pillar: "duality", northStar: ["revenue", "profit"], keyResults: [
                            { text: "Develop and deploy a library of 15 distinct, production-ready AI agents", status: "Not Started" },
                            { text: "Package proprietary models as a premium add-on for the Synapse platform with a clear pricing model", status: "Not Started" },
                            { text: "Ensure 75% of new Synapse customers adopt at least one premium AI feature", status: "Not Started" },
                            { text: "Ensure 80% of new client AI projects leverage at least 3 agents from the central library", status: "Not Started" },
                            { text: "Reduce the cost-per-inference by 40% through model optimization and quantization techniques", status: "Not Started" },
                        ]},
                        { title: "Drive Ecosystem Leadership via Marketplace and Open Source", pillar: "opensource", northStar: ["leadership", "alliances", "customers"], keyResults: [
                            { text: "List and get approval for 3 core Blueprint products on the Databricks Marketplace", status: "Not Started" },
                            { text: "Achieve Featured Partner status on the Marketplace homepage for at least one quarter", status: "Not Started" },
                            { text: "Release a valuable component of our stack as an open-source project and achieve 1,000 GitHub stars", status: "Not Started" },
                            { text: "Attract 2 senior engineering hires who cite the open-source project as a primary reason for joining", status: "Not Started" },
                            { text: "Generate 500 new MQLs directly from our Databricks Marketplace listings", status: "Not Started" },
                        ]},
                        { title: "Ensure Enterprise-Grade Security, Scalability, and Ethics", pillar: "troika", northStar: ["leadership"], keyResults: [
                            { text: "Obtain SOC 2 Type II compliance for the Cortex platform", status: "Not Started" },
                            { text: "Ensure core products are fully portable and deployable on AWS, Azure, and GCP", status: "Not Started" },
                            { text: "Implement a formal AI Ethics Review Board that signs off on all new agent and model deployments", status: "Not Started" },
                            { text: "Pass 3 external penetration tests with zero critical vulnerabilities found", status: "Not Started" },
                            { text: "File for 3 patents related to the novel technologies within Cortex and Liftoff", status: "Not Started" },
                        ]}
                    ]
                },
                 {
                    name: "Delivery",
                    goal: "To transform Delivery into a strategic Center of Excellence (CoE) that drives product-led growth, ensures world-class customer outcomes, and fuels the company's marketing and sales flywheel.",
                    objectives: [
                        { title: "Win Databricks Partner of the Year via CoE Excellence", pillar: "flywheel", northStar: ["leadership", "profit"], keyResults: [
                            { text: "Staff a CoE with 10 of our top architects (Builders) ring-fenced from standard billable work", status: "Not Started" },
                            { text: "Have the CoE identify and document 3 client success stories that perfectly align with award categories", status: "Not Started" },
                            { text: "Win at least one major Databricks Partner of the Year award", status: "Not Started" },
                            { text: "Produce 3 video testimonials with these clients to be included in the award submissions", status: "Not Started" },
                            { text: "Establish a CoE charter that defines its mandate for IP creation, best practices, and training", status: "Not Started" },
                        ]},
                        { title: "Implement a Product-Led Delivery Model for Efficiency", pillar: "duality", northStar: ["profit"], keyResults: [
                            { text: "Reduce the average time-to-value for new clients by 30% using our Liftoff and Synapse products", status: "Not Started" },
                            { text: "Increase the gross margin on product-led projects to 60%, compared to 40% for pure-services projects", status: "Not Started" },
                            { text: "Achieve a 95% on-time, on-budget project completion rate for all product-led engagements", status: "Not Started" },
                            { text: "Increase the reuse of CoE-developed code modules and frameworks by 40%", status: "Not Started" },
                            { text: "Reduce project startup time from 2 weeks to 3 days", status: "Not Started" },
                        ]},
                        { title: "Aggressively Increase Databricks Expertise and Certifications", pillar: "troika", northStar: ["alliances", "leadership"], keyResults: [
                            { text: "Increase the total number of Databricks certifications across the company by 50%", status: "Not Started" },
                            { text: "Achieve Databricks Expert-level competency in at least 2 strategic areas (e.g., AI/ML, Data Engineering)", status: "Not Started" },
                            { text: "Ensure 100% of client-facing delivery staff hold at least one Databricks certification", status: "Not Started" },
                            { text: "Deliver 20 client-facing Bootcamps for our flagship products in 2026", status: "Not Started" },
                            { text: "Convert 50% of Bootcamp engagements into larger, follow-on projects", status: "Not Started" },
                        ]},
                        { title: "Ensure World-Class Customer Success and Expansion", pillar: "flywheel", northStar: ["revenue", "customers"], keyResults: [
                            { text: "Achieve a Net Promoter Score (NPS) of +60 across all active clients", status: "Not Started" },
                            { text: "Ensure 80% of clients expand their engagement with us within 12 months", status: "Not Started" },
                            { text: "Reduce customer churn to less than 5% annually", status: "Not Started" },
                            { text: "Implement a mandatory Sales-to-Delivery Handoff meeting for 100% of new projects", status: "Not Started" },
                            { text: "Maintain a firm-wide billable utilization rate of 80% for our Scaler delivery consultants", status: "Not Started" },
                        ]}
                    ]
                },
                 {
                    name: "Sales",
                    goal: "To build a world-class sales organization that executes a disciplined, solution-centric GTM motion, masters the Troika partnership, and consistently exceeds revenue targets.",
                    objectives: [
                        { title: "Achieve Revenue and New Customer Acquisition Targets", pillar: "flywheel", northStar: ["revenue", "profit", "customers"], keyResults: [
                            { text: "Achieve $23M in new bookings for the fiscal year", status: "Not Started" },
                            { text: "Secure 180 new customers through product-led and solution-based selling", status: "Not Started" },
                            { text: "Increase Net Revenue Retention (NRR) to 150%", status: "Not Started" },
                            { text: "Increase the average initial deal size by 25%", status: "Not Started" },
                            { text: "Convert 75% of 'Acquire' phase clients into multi-year 'Expand/Scale' phase partners", status: "Not Started" },
                        ]},
                        { title: "Master the Troika Partnership with Databricks and Hyperscalers", pillar: "troika", northStar: ["alliances", "revenue"], keyResults: [
                            { text: "Achieve top-tier partner status with AWS and Azure", status: "Not Started" },
                            { text: "Generate 30% of our total sales pipeline through hyperscaler co-sell channels", status: "Not Started" },
                            { text: "Target a 3x increase in Databricks-sourced bookings", status: "Not Started" },
                            { text: "Secure $500k in co-sell funding from partners to subsidize POCs and pilots", status: "Not Started" },
                            { text: "Secure 20 meetings with C-level executives at our top target accounts", status: "Not Started" },
                        ]},
                        { title: "Transition to a Product-Led and Solution-Based Selling Motion", pillar: "duality", northStar: ["revenue"], keyResults: [
                            { text: "Shift 80% of initial sales conversations away from staff augmentation to our Liftoff and Synapse offerings", status: "Not Started" },
                            { text: "Increase the product-attach rate to 90% for all new deals", status: "Not Started" },
                            { text: "Decrease the average sales cycle from 90 days to 65 days for product-led deals", status: "Not Started" },
                            { text: "Generate 40% of the sales pipeline from marketing-sourced leads", status: "Not Started" },
                            { text: "Achieve 100% adoption of our defined MEDDPICC sales methodology", status: "Not Started" },
                        ]},
                        { title: "Build a High-Performance, Specialized Sales Team", pillar: "talent", northStar: ["revenue", "customers"], keyResults: [
                            { text: "Hire 5 new Account Executives who meet our Challenger Sale profile", status: "Not Started" },
                            { text: "Create 3 dedicated industry verticals (e.g., Retail, Financial Services) with Vertical Leads", status: "Not Started" },
                            { text: "Ensure 60% of new revenue comes from our target industry verticals", status: "Not Started" },
                            { text: "Achieve 80% quota attainment across the sales team", status: "Not Started" },
                            { text: "Implement a rigorous sales training and certification program for all reps", status: "Not Started" },
                        ]}
                    ]
                },
                {
                    name: "Marketing",
                    goal: "To build a powerful, respected brand in the Databricks ecosystem and operate the Awards-to-Sales Flywheel as a predictable, scalable demand generation engine.",
                    objectives: [
                        { title: "Execute the Awards-to-Sales Flywheel to Perfection", pillar: "flywheel", northStar: ["leadership", "revenue"], keyResults: [
                            { text: "Win a major Databricks Partner of the Year award", status: "Not Started" },
                            { text: "Launch a multi-channel campaign around the win that generates 1,000 new leads", status: "Not Started" },
                            { text: "Directly attribute $5M in sales pipeline to the awards campaign", status: "Not Started" },
                            { text: "Produce 10 video case studies with satisfied clients", status: "Not Started" },
                            { text: "Establish a formal customer reference program with 20 active participants", status: "Not Started" },
                        ]},
                        { title: "Establish Premier Thought Leadership in the Databricks Ecosystem", pillar: "flywheel", northStar: ["leadership"], keyResults: [
                            { text: "Publish a definitive 'State of Databricks' annual report that becomes the industry benchmark", status: "Not Started" },
                            { text: "Secure 10 media placements or bylines in top-tier tech publications", status: "Not Started" },
                            { text: "Increase our share of voice on social media for key Databricks-related terms by 300%", status: "Not Started" },
                            { text: "Publish 50 high-quality, technical blog posts and 4 long-form whitepapers", status: "Not Started" },
                            { text: "Host 12 webinars with an average attendance of 200 people", status: "Not Started" },
                        ]},
                        { title: "Drive Predictable, High-Quality Pipeline for New Customer Acquisition", pillar: "flywheel", northStar: ["revenue", "customers"], keyResults: [
                            { text: "Generate 500 Marketing Qualified Leads (MQLs) per quarter", status: "Not Started" },
                            { text: "Achieve a 30% MQL-to-SQL conversion rate", status: "Not Started" },
                            { text: "Source 40% of the company's total sales pipeline", status: "Not Started" },
                            { text: "Relaunch the Blueprint website with new product-focused messaging", status: "Not Started" },
                            { text: "Improve our website's conversion rate from 1% to 3%", status: "Not Started" },
                        ]},
                        { title: "Dominate Key Industry Events with Targeted ABM Campaigns", pillar: "flywheel", northStar: ["leadership", "customers"], keyResults: [
                            { text: "Secure a premium sponsorship and speaking slot at the Databricks Data + AI Summit", status: "Not Started" },
                            { text: "Launch targeted ABM campaigns against our top 50 target accounts, generating 10 new opportunities", status: "Not Started" },
                            { text: "Generate 200 qualified leads and schedule 50 meetings from our presence at the Summit", status: "Not Started" },
                            { text: "Host the most talked-about party or networking event at the Summit", status: "Not Started" },
                            { text: "Achieve a 50% engagement rate within those target accounts", status: "Not Started" },
                        ]}
                    ]
                },
                {
                    name: "Operations",
                    goal: "To build the scalable systems, talent frameworks, and financial models required to operate as a high-growth, profitable, product-led technology company.",
                    objectives: [
                        { title: "Implement the 'Builder vs. Scaler' Dual-Career Talent Model", pillar: "talent", northStar: ["profit", "leadership"], keyResults: [
                            { text: "Finalize and roll out the job descriptions, competencies, and compensation bands for both tracks by Q1", status: "Not Started" },
                            { text: "Successfully transition 90% of the technical team into the new framework without voluntary attrition", status: "Not Started" },
                            { text: "Implement a formal rotation program and have 10% of the team participate", status: "Not Started" },
                            { text: "Launch a new performance management process based on regular feedback and coaching", status: "Not Started" },
                            { text: "Develop a structured, 4-week onboarding program for all new hires", status: "Not Started" },
                        ]},
                        { title: "Become a Top Workplace and Significantly Reduce Attrition", pillar: "talent", northStar: ["leadership"], keyResults: [
                            { text: "Reduce overall voluntary attrition from 15% to below 10%", status: "Not Started" },
                            { text: "Increase our employee Net Promoter Score (eNPS) from +20 to +45", status: "Not Started" },
                            { text: "Be named one of the 'Best Places to Work' in our region", status: "Not Started" },
                            { text: "Reduce the average time-to-hire for technical roles from 45 to 30 days", status: "Not Started" },
                            { text: "Increase the percentage of new hires sourced from employee referrals to 40%", status: "Not Started" },
                        ]},
                        { title: "Re-architect Financial and IT Systems for a Product-Led Business", pillar: "duality", northStar: ["profit"], keyResults: [
                            { text: "Implement new financial software to manage hybrid subscription and services revenue models", status: "Not Started" },
                            { text: "Deliver monthly reports that clearly distinguish between product ARR and services revenue", status: "Not Started" },
                            { text: "Consolidate our CRM, ERP, and PSA systems onto a single, integrated platform", status: "Not Started" },
                            { text: "Select and implement a dedicated OKR software platform by Q1", status: "Not Started" },
                            { text: "Reduce the number of manual, spreadsheet-based operational processes by 50%", status: "Not Started" },
                        ]},
                        { title: "Improve Profitability and Cash Flow", pillar: "duality", northStar: ["profit"], keyResults: [
                            { text: "Increase overall EBITDA margin to 21%", status: "Not Started" },
                            { text: "Reduce Days Sales Outstanding (DSO) from 60 to 45 days", status: "Not Started" },
                            { text: "Maintain a cash reserve of at least 6 months of operating expenses", status: "Not Started" },
                            { text: "Create standardized, templatized contracts for all product and service offerings", status: "Not Started" },
                            { text: "Reduce the average contract negotiation cycle time by 30%", status: "Not Started" },
                        ]}
                    ]
                }
            ]
        };
        
        let charts = {};
        const STATUS_COLORS = {
            "Not Started": "#374151",
            "On Track": "#3b82f6",
            "At Risk": "#f59e0b",
            "Completed": "#10b981"
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderNorthStarMetrics();
            renderPillars();
            renderSidebarTabs();
            renderAllDepartments();
            populateAreaFilter(); 
            updateGlobalProgressTracker();
            updateLeaderboard();
            addGlobalEventListeners(); 
        });
        
        function addGlobalEventListeners() {
            const northStarModal = document.getElementById('north-star-modal');
            const northStarModalClose = document.getElementById('north-star-modal-close');
            if (northStarModal && northStarModalClose) {
                northStarModalClose.addEventListener('click', () => northStarModal.classList.add('hidden'));
                northStarModal.addEventListener('click', (e) => {
                    if (e.target === northStarModal) {
                        northStarModal.classList.add('hidden');
                    }
                });
            }

            document.getElementById('okr-search')?.addEventListener('input', applyAllFilters);
            document.getElementById('area-filter')?.addEventListener('change', applyAllFilters);
        }

        function calculateDepartmentStats(dept, pillarFilter = 'all') {
            let total = 0;
            let completed = 0;
            let onTrack = 0;
            let atRisk = 0;
            
            dept.objectives.forEach(obj => {
                // Only count objectives that match the pillar filter
                if (pillarFilter === 'all' || obj.pillar === pillarFilter) {
                    total += obj.keyResults.length;
                    obj.keyResults.forEach(kr => {
                        if (kr.status === 'Completed') completed++;
                        if (kr.status === 'On Track') onTrack++;
                        if (kr.status === 'At Risk') atRisk++;
                    });
                }
            });
            
            const completionRate = total > 0 ? (completed / total) * 100 : 0;
            const onTrackRate = total > 0 ? ((completed + onTrack) / total) * 100 : 0;
            
            return { total, completed, onTrack, atRisk, completionRate, onTrackRate };
        }

        function updateLeaderboard(pillarFilter = 'all') {
            const leaderboardContent = document.getElementById('leaderboard-content');
            if (!leaderboardContent) return;
            
            const departmentStats = strategyData.departments.map(dept => {
                const stats = calculateDepartmentStats(dept, pillarFilter);
                return {
                    name: dept.name,
                    ...stats
                };
            }).filter(dept => dept.total > 0); // Only show departments with objectives matching the filter
            
            departmentStats.sort((a, b) => b.completionRate - a.completionRate);
            
            const allZero = departmentStats.every(dept => dept.completionRate === 0);
            
            if (allZero || departmentStats.length === 0) {
                leaderboardContent.innerHTML = `
                    <div class="flex items-center gap-3 text-gray-400">
                        <span class="text-2xl">üèÅ</span>
                        <div>
                            <p class="font-semibold text-sm">${departmentStats.length === 0 ? 'No matching objectives' : 'Race hasn\'t started yet!'}</p>
                            <p class="text-xs">${departmentStats.length === 0 ? 'Try a different filter' : 'Complete some key results to see leaders'}</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const topThree = departmentStats.slice(0, 3);
            const rankEmojis = ['ü•á', 'ü•à', 'ü•â'];
            
            let leaderboardHtml = topThree.map((dept, index) => {
                const isLeader = index === 0;
                return `
                    <div class="flex items-center gap-2 ${isLeader ? 'leader-glow' : ''}">
                        <span class="text-xl ${isLeader ? 'trophy-winner' : ''}">${rankEmojis[index]}</span>
                        <div>
                            <p class="font-bold text-white text-xs">${dept.name}</p>
                            <div class="flex items-center gap-2">
                                <div class="w-16 h-1.5 bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-emerald-500 transition-all duration-500" style="width: ${dept.completionRate}%"></div>
                                </div>
                                <span class="text-xs font-semibold ${isLeader ? 'text-emerald-400' : 'text-gray-400'}">${Math.round(dept.completionRate)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            leaderboardContent.innerHTML = leaderboardHtml;
        }
        
        function updateGlobalProgressTracker(pillarFilter = 'all') {
            let totalKRs = 0;
            let completedKRs = 0;
            let onTrackKRs = 0;
            let atRiskKRs = 0;
            
            strategyData.departments.forEach(dept => {
                dept.objectives.forEach(obj => {
                    // Only count objectives that match the pillar filter
                    if (pillarFilter === 'all' || obj.pillar === pillarFilter) {
                        totalKRs += obj.keyResults.length;
                        obj.keyResults.forEach(kr => {
                            if (kr.status === 'Completed') completedKRs++;
                            if (kr.status === 'On Track') onTrackKRs++;
                            if (kr.status === 'At Risk') atRiskKRs++;
                        });
                    }
                });
            });

            const completionPercentage = totalKRs > 0 ? (completedKRs / totalKRs) * 100 : 0;
            
            const progressCircle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 50;
            const offset = circumference - (completionPercentage / 100) * circumference;
            if(progressCircle) {
                progressCircle.style.strokeDashoffset = offset;
            }
            
            const percentageEl = document.getElementById('progress-percentage');
            if(percentageEl) percentageEl.textContent = `${Math.round(completionPercentage)}%`;
            
            if(document.getElementById('total-krs')) document.getElementById('total-krs').textContent = totalKRs;
            if(document.getElementById('completed-krs')) document.getElementById('completed-krs').textContent = completedKRs;
            if(document.getElementById('ontrack-krs')) document.getElementById('ontrack-krs').textContent = onTrackKRs;
            if(document.getElementById('atrisk-krs')) document.getElementById('atrisk-krs').textContent = atRiskKRs;
            
            updateLeaderboard(pillarFilter);
        }

        function getNorthStarSymbols(northStarIds = []) {
            return northStarIds.map(id => {
                const metric = strategyData.northStarMetrics.find(m => m.id === id);
                return metric ? `<span class="inline-block ml-1" title="${metric.label}">${metric.symbol}</span>` : '';
            }).join('');
        }

        function renderNorthStarMetrics() {
            const grid = document.getElementById('north-star-metrics-grid');
            const legend = document.getElementById('symbol-legend');

            strategyData.northStarMetrics.forEach(metric => {
                const card = document.createElement('div');
                card.className = 'north-star-card bg-gray-800/50 p-3 rounded-xl border border-gray-700 shadow-lg text-center transform hover:-translate-y-1 transition-transform duration-300 cursor-pointer flex flex-col justify-between';
                card.dataset.metricId = metric.id;
                card.innerHTML = `
                    <div>
                        <p class="text-xs font-medium text-gray-400 uppercase tracking-wider mb-1">${metric.label}</p>
                        <p class="text-2xl font-bold text-blue-500 my-1">${metric.symbol} ${metric.value}</p>
                        <p class="text-xs font-semibold text-white">${metric.sub}</p>
                    </div>
                `;
                card.addEventListener('click', () => showNorthStarModal(metric.id, `${metric.symbol} ${metric.label}`));
                grid.appendChild(card);
            });
            
            // Render legend
            let legendHtml = '<span class="font-bold text-white mr-2">Legend:</span>';
            strategyData.northStarMetrics.forEach(metric => {
                legendHtml += `<span class="flex items-center"><span class="font-bold text-base mr-1">${metric.symbol}</span> = ${metric.label}</span>`;
            });
            if (legend) legend.innerHTML = legendHtml;
        }

        function renderPillars() {
            const grid = document.getElementById('pillars-inline');
            const feedbackEl = document.getElementById('pillar-filter-feedback');
            const allPillars = { id: "all", name: "Show All", description: "Show all objectives across all strategic pillars" };

            [allPillars, ...strategyData.strategicPillars].forEach(pillar => {
                const button = document.createElement('button');
                button.className = 'pillar-btn border border-gray-600 text-gray-300 text-xs font-medium py-1 px-3 rounded-full hover:bg-gray-800 hover:border-blue-500 hover:text-white transition-colors duration-300';
                if (pillar.id === 'all') {
                    button.classList.add('pillar-active');
                }
                button.textContent = pillar.name;
                button.dataset.pillarId = pillar.id;
                button.title = pillar.description;
                button.addEventListener('click', () => {
                    document.querySelectorAll('.pillar-btn').forEach(btn => btn.classList.remove('pillar-active'));
                    button.classList.add('pillar-active');
                    
                    if (pillar.id === 'all') {
                        feedbackEl.style.display = 'none';
                    } else {
                        feedbackEl.innerHTML = `Filtering by: <strong class="text-white">${pillar.name}</strong>`;
                        feedbackEl.style.display = 'block';
                    }
                    applyGlobalPillarFilter(pillar.id);
                });
                grid.appendChild(button);
            });
        }
        
        function populateAreaFilter() {
            const filter = document.getElementById('area-filter');
            if (!filter) return;

            let optionsHtml = `<option value="all">All Departments</option>`;
            strategyData.departments.forEach(dept => {
                optionsHtml += `<option value="${dept.name}">${dept.name}</option>`;
            });
            filter.innerHTML = optionsHtml;
        }

        function renderSidebarTabs() {
            const sidebar = document.getElementById('sidebar-tabs');
            if (!sidebar) return;
            sidebar.innerHTML = ''; // Clear existing tabs
            const allDeptsTab = { name: "All Departments" };
            
            [allDeptsTab, ...strategyData.departments].forEach((dept, index) => {
                const tab = document.createElement('button');
                tab.className = `sidebar-tab text-sm font-medium text-gray-300 hover:text-white ${index === 0 ? 'tab-active' : ''}`;
                
                if (dept.name === "All Departments") {
                    tab.textContent = dept.name;
                } else {
                    const deptIcon = strategyData.departmentIcons[dept.name] || "";
                    tab.innerHTML = `<span class="mr-2">${deptIcon}</span>${dept.name}`;
                }
                
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');
                    
                    if (dept.name === "All Departments") {
                        renderAllDepartments();
                    } else {
                        renderDepartment(dept.name);
                    }
                    applyAllFilters();
                });
                sidebar.appendChild(tab);
            });
        }
        
        function renderAllDepartments() {
             const contentContainer = document.getElementById('tab-content');
             if (!contentContainer) return;
             let allHtml = '<div id="all-okrs-list" class="space-y-6">';

             strategyData.departments.forEach(department => {
                 const deptIcon = strategyData.departmentIcons[department.name] || "";
                 allHtml += `<div class="department-group" data-department-name="${department.name}">`;
                 allHtml += `<h3 class="department-name text-xl font-bold text-blue-400 mb-3 border-b border-gray-700 pb-2 flex items-center gap-2">
                     <span class="text-2xl">${deptIcon}</span>
                     ${department.name}
                 </h3>`;
                 allHtml += `<div class="space-y-3">`;

                 department.objectives.forEach((obj, index) => {
                     const symbols = getNorthStarSymbols(obj.northStar);
                     const krsText = obj.keyResults.map(k => k.text.toLowerCase()).join(' ');
                     let krHtml = obj.keyResults.map((kr, krIndex) => `
                         <li class="flex items-start space-x-3 py-2">
                             <span class="flex-shrink-0 h-5 w-5 rounded-full bg-blue-500/20 text-blue-300 font-semibold text-xs flex items-center justify-center">KR${krIndex + 1}</span>
                             <div class="flex-grow">
                                 <p class="text-sm text-gray-300">${kr.text}</p>
                             </div>
                             <div class="flex-shrink-0">
                                 <select data-dept="${department.name}" data-obj-index="${index}" data-kr-index="${krIndex}" class="status-selector bg-gray-700 border border-gray-600 text-gray-200 text-xs rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full p-1">
                                     <option ${kr.status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                                     <option ${kr.status === 'On Track' ? 'selected' : ''}>On Track</option>
                                     <option ${kr.status === 'At Risk' ? 'selected' : ''}>At Risk</option>
                                     <option ${kr.status === 'Completed' ? 'selected' : ''}>Completed</option>
                                 </select>
                             </div>
                         </li>
                     `).join('');

                     allHtml += `
                         <div class="okr-item border border-gray-700 rounded-lg overflow-hidden" data-pillar="${obj.pillar}" data-title="${obj.title.toLowerCase()}" data-krs="${krsText}">
                              <button type="button" class="accordion-toggle w-full text-left p-3 bg-gray-800/50 hover:bg-gray-800 flex justify-between items-center">
                                 <span class="text-sm font-semibold text-white">${index + 1}. ${obj.title} ${symbols}</span>
                                 <svg class="accordion-icon w-4 h-4 transform transition-transform text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                             </button>
                             <div class="accordion-content">
                                 <ul class="px-3 divide-y divide-gray-700">
                                    ${krHtml}
                                 </ul>
                             </div>
                         </div>
                     `;
                 });
                 allHtml += `</div></div>`;
             });

             allHtml += `</div>`;
             contentContainer.innerHTML = allHtml;
             setupDynamicEventListeners(contentContainer);
        }

        function renderDepartment(deptName) {
            const department = strategyData.departments.find(d => d.name === deptName);
            if (!department) return;
            const deptIcon = strategyData.departmentIcons[deptName] || "";
            const contentContainer = document.getElementById('tab-content');
            if (!contentContainer) return;
            
            contentContainer.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center mb-4 bg-gray-800/30 p-4 rounded-lg border border-gray-700" style="gap: 0;">
                        <div class="flex-shrink-0 text-6xl" style="line-height: 1; margin-right: 10px;">
                            ${deptIcon}
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-white mb-1">${department.name}</h3>
                            <p class="text-sm text-gray-400">${department.goal}</p>
                        </div>
                    </div>
                    <div id="okr-list-${deptName.replace(/\s+/g, '')}" class="space-y-3"></div>
                </div>
            `;

            const okrList = document.getElementById(`okr-list-${deptName.replace(/\s+/g, '')}`);
            if (!okrList) return;
            
            department.objectives.forEach((obj, index) => {
                const symbols = getNorthStarSymbols(obj.northStar);
                const krsText = obj.keyResults.map(k => k.text.toLowerCase()).join(' ');
                
                let krHtml = obj.keyResults.map((kr, krIndex) => `
                    <li class="flex items-start space-x-3 py-2">
                        <span class="flex-shrink-0 h-5 w-5 rounded-full bg-blue-500/20 text-blue-300 font-semibold text-xs flex items-center justify-center">KR${krIndex + 1}</span>
                        <div class="flex-grow">
                            <p class="text-sm text-gray-300">${kr.text}</p>
                        </div>
                        <div class="flex-shrink-0">
                            <select data-dept="${department.name}" data-obj-index="${index}" data-kr-index="${krIndex}" class="status-selector bg-gray-700 border border-gray-600 text-gray-200 text-xs rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full p-1">
                                <option ${kr.status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                                <option ${kr.status === 'On Track' ? 'selected' : ''}>On Track</option>
                                <option ${kr.status === 'At Risk' ? 'selected' : ''}>At Risk</option>
                                <option ${kr.status === 'Completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                    </li>
                `).join('');

                const objectiveHTML = `
                    <div class="okr-item border border-gray-700 rounded-lg overflow-hidden" data-pillar="${obj.pillar}" data-title="${obj.title.toLowerCase()}" data-krs="${krsText}">
                        <button type="button" class="accordion-toggle w-full text-left p-3 bg-gray-800/50 hover:bg-gray-800 flex justify-between items-center">
                            <span class="text-sm font-semibold text-white">${index + 1}. ${obj.title} ${symbols}</span>
                            <svg class="accordion-icon w-4 h-4 transform transition-transform text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <ul class="px-3 divide-y divide-gray-700">
                               ${krHtml}
                            </ul>
                        </div>
                    </div>
                `;
                
                okrList.insertAdjacentHTML('beforeend', objectiveHTML);
            });

            setupDynamicEventListeners(contentContainer);
        }
        
        function createDepartmentChart(department) {
            const canvasId = `${department.name.replace(/\s+/g, '')}-chart`;
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            // Get current pillar filter
            const activePillarEl = document.querySelector('.pillar-btn.pillar-active');
            const currentPillar = activePillarEl ? activePillarEl.dataset.pillarId : 'all';
            
            const statusCounts = { "Not Started": 0, "On Track": 0, "At Risk": 0, "Completed": 0 };
            department.objectives.forEach(obj => {
                // Only count objectives that match the pillar filter
                if (currentPillar === 'all' || obj.pillar === currentPillar) {
                    obj.keyResults.forEach(kr => statusCounts[kr.status]++);
                }
            });
            
            if (charts[department.name]) {
                charts[department.name].destroy();
            }

            charts[department.name] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: Object.values(STATUS_COLORS),
                        borderColor: '#111827',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: { legend: { display: false }, tooltip: { enabled: true } }
                }
            });
        }
        
        function setupDynamicEventListeners(container) {
             if (!container) return;
             
             const newContainer = container.cloneNode(true);
             container.parentNode.replaceChild(newContainer, container);
             
             const freshContainer = document.getElementById('tab-content');
             if (!freshContainer) return;

             freshContainer.querySelectorAll('.accordion-toggle').forEach(toggle => {
                 toggle.addEventListener('click', function(e) {
                     e.preventDefault();
                     const content = this.nextElementSibling;
                     const icon = this.querySelector('.accordion-icon');
                     
                     if (content.style.maxHeight) {
                         content.style.maxHeight = null;
                         if (icon) icon.classList.remove('rotate-180');
                     } else {
                         content.style.maxHeight = content.scrollHeight + "px";
                         if (icon) icon.classList.add('rotate-180');
                     }
                 });
             });
             
             freshContainer.querySelectorAll('.status-selector').forEach(selector => {
                 selector.addEventListener('change', function() {
                     const { dept, objIndex, krIndex } = this.dataset;
                     const newStatus = this.value;
                     const department = strategyData.departments.find(d => d.name === dept);
                     if(department) {
                         department.objectives[objIndex].keyResults[krIndex].status = newStatus;
                         if(charts[department.name]) {
                            createDepartmentChart(department);
                         }
                         // Get current pillar filter and update with it
                         const activePillarEl = document.querySelector('.pillar-btn.pillar-active');
                         const currentPillar = activePillarEl ? activePillarEl.dataset.pillarId : 'all';
                         updateGlobalProgressTracker(currentPillar);
                     }
                 });
             });
        }
        
        function applyAllFilters() {
            const searchTerm = document.getElementById('okr-search').value.toLowerCase();
            const selectedArea = document.getElementById('area-filter').value;
            const activePillarEl = document.querySelector('.pillar-btn.pillar-active');
            const selectedPillar = activePillarEl ? activePillarEl.dataset.pillarId : 'all';
            const activeSidebarTab = document.querySelector('.sidebar-tab.tab-active');
            if (!activeSidebarTab) return;
            const allDeptTabActive = activeSidebarTab.textContent === 'All Departments';

            if (allDeptTabActive) {
                const departmentGroups = document.querySelectorAll('#all-okrs-list .department-group');
                departmentGroups.forEach(group => {
                    const departmentName = group.dataset.departmentName;
                    let groupHasVisibleItems = false;
                    const areaMatch = selectedArea === 'all' || departmentName === selectedArea;

                    const okrItems = group.querySelectorAll('.okr-item');
                    okrItems.forEach(item => {
                        const pillarMatch = selectedPillar === 'all' || item.dataset.pillar === selectedPillar;
                        const searchMatch = searchTerm === '' || item.dataset.title.includes(searchTerm) || item.dataset.krs.includes(searchTerm);

                        if (pillarMatch && searchMatch) {
                            item.style.display = 'block';
                            groupHasVisibleItems = true;
                        } else {
                            item.style.display = 'none';
                        }
                    });

                    if (areaMatch && groupHasVisibleItems) {
                        group.style.display = 'block';
                    } else {
                        group.style.display = 'none';
                    }
                });
            } else {
                const okrItems = document.querySelectorAll('#tab-content .okr-item');
                okrItems.forEach(item => {
                    const pillarMatch = selectedPillar === 'all' || item.dataset.pillar === selectedPillar;
                    const searchMatch = searchTerm === '' || item.dataset.title.includes(searchTerm) || item.dataset.krs.includes(searchTerm);

                    if (pillarMatch && searchMatch) {
                       item.style.display = 'block';
                   } else {
                       item.style.display = 'none';
                   }
                });
            }
        }
        
        function applyGlobalPillarFilter(pillarId) {
            // Filter North Star Metrics
            filterNorthStarMetrics(pillarId);
            
            // Update trackers with filtered data
            updateGlobalProgressTracker(pillarId);
            
            // Apply filter to OKRs
            applyAllFilters();
        }
        
        function filterNorthStarMetrics(pillarId) {
            const grid = document.getElementById('north-star-metrics-grid');
            const cards = grid.querySelectorAll('.north-star-card');
            
            if (pillarId === 'all') {
                cards.forEach(card => card.style.display = 'block');
                return;
            }
            
            // Find which North Star metrics are referenced by objectives with this pillar
            const relevantMetrics = new Set();
            strategyData.departments.forEach(dept => {
                dept.objectives.forEach(obj => {
                    if (obj.pillar === pillarId && obj.northStar) {
                        obj.northStar.forEach(metricId => relevantMetrics.add(metricId));
                    }
                });
            });
            
            cards.forEach(card => {
                if (relevantMetrics.has(card.dataset.metricId)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function showNorthStarModal(metricId, metricLabel) {
            const modal = document.getElementById('north-star-modal');
            const title = document.getElementById('north-star-modal-title');
            const content = document.getElementById('north-star-modal-content');
            if (!modal || !title || !content) return;
            
            // Get current pillar filter
            const activePillarEl = document.querySelector('.pillar-btn.pillar-active');
            const currentPillar = activePillarEl ? activePillarEl.dataset.pillarId : 'all';
            
            title.innerHTML = `Objectives aligned with: ${metricLabel}`;
            let contentHtml = '';
            strategyData.departments.forEach(dept => {
                const matchingObjectives = dept.objectives.filter(obj => {
                    const matchesMetric = obj.northStar && obj.northStar.includes(metricId);
                    const matchesPillar = currentPillar === 'all' || obj.pillar === currentPillar;
                    return matchesMetric && matchesPillar;
                });
                if (matchingObjectives.length > 0) {
                    contentHtml += `<div class="mb-4">
                        <h4 class="text-base font-bold text-blue-400 border-b border-gray-600 pb-2 mb-2">${dept.name}</h4>
                        <ul class="space-y-2">${matchingObjectives.map(obj => `
                            <li class="bg-gray-800/50 p-2 rounded-md">
                                <p class="text-sm font-semibold text-white">${obj.title}</p>
                            </li>`).join('')}
                        </ul></div>`;
                }
            });
            content.innerHTML = contentHtml || '<p class="text-sm text-gray-400">No objectives are currently aligned with this North Star Metric.</p>';
            modal.classList.remove('hidden');
        }
    </script>
</body>
</html>

